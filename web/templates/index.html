<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tubarr - YouTube to Jellyfin Manager</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="container-fluid py-3 px-4">
            <div class="d-flex justify-content-between align-items-center">
                <div class="logo-container">
                    <div class="logo-icon">
                        <i class="bi bi-play-fill"></i>
                    </div>
                    <div class="logo-text">
                        <h1>TUBARR</h1>
                        <p>YouTube to Jellyfin Manager</p>
                    </div>
                </div>
                <button class="btn-new-download" id="header-new-download">
                    <i class="bi bi-plus-lg"></i>
                    New Download
                </button>
            </div>
        </div>
    </header>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 sidebar">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" data-section="dashboard">
                            <i class="bi bi-house-door"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="new-job">
                            <i class="bi bi-tv"></i>
                            <span>New TV Download</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="new-movie">
                            <i class="bi bi-film"></i>
                            <span>New Movie Download</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="new-music">
                            <i class="bi bi-music-note-beamed"></i>
                            <span>New Music Download</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="new-audiobook">
                            <i class="bi bi-journal-richtext"></i>
                            <span>New Audiobook Download</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="jobs">
                            <i class="bi bi-list-task"></i>
                            <span>Jobs</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="history">
                            <i class="bi bi-clock-history"></i>
                            <span>History</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="subscriptions">
                            <i class="bi bi-bell"></i>
                            <span>Subscriptions</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-section="settings">
                            <i class="bi bi-gear"></i>
                            <span>Settings</span>
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Main Content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Dashboard Section -->
                <section id="dashboard" class="content-section active">
                    <h2>Dashboard</h2>

                    <div class="tip-callout" data-tip-id="dashboard">
                        <div class="tip-icon">
                            <i class="bi bi-lightbulb"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-2">Welcome to Tubarr</h6>
                            <div class="tip-content">
                                <p class="mb-2">Use these quick hints to move from a YouTube link to a finished download in just a few clicks.</p>
                                <ul class="tip-list">
                                    <li>Select <strong>New TV Download</strong> or <strong>New Movie Download</strong> from the sidebar to create a job.</li>
                                    <li>Keep an eye on the <strong>Jobs</strong> tab to monitor progress and retry failures.</li>
                                    <li>Save time with <strong>Subscriptions</strong> to automatically create new TV jobs when channels update.</li>
                                </ul>
                            </div>
                        </div>
                        <button class="tip-toggle" aria-label="Toggle tip">
                            <i class="bi bi-chevron-up"></i>
                        </button>
                    </div>

                    <!-- Stats Grid -->
                    <div class="row mb-4">
                        <div class="dashboard-col col-md-6 col-lg mb-3">
                            <div class="stat-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="stat-label">Total Shows</div>
                                        <div class="stat-value" id="total-shows">0</div>
                                    </div>
                                    <div class="stat-icon bg-blue">
                                        <i class="bi bi-tv"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="dashboard-col col-md-6 col-lg mb-3">
                            <div class="stat-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="stat-label">Total Episodes</div>
                                        <div class="stat-value" id="total-episodes">0</div>
                                    </div>
                                    <div class="stat-icon bg-green">
                                        <i class="bi bi-film"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="dashboard-col col-md-6 col-lg mb-3">
                            <div class="stat-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="stat-label">Total Movies</div>
                                        <div class="stat-value" id="total-movies">0</div>
                                    </div>
                                    <div class="stat-icon bg-purple">
                                        <i class="bi bi-collection-play"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="dashboard-col col-md-6 col-lg mb-3">
                            <div class="stat-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="stat-label">Active Jobs</div>
                                        <div class="stat-value" id="active-jobs">0</div>
                                    </div>
                                    <div class="stat-icon bg-cyan">
                                        <i class="bi bi-arrow-repeat"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="dashboard-col col-md-6 col-lg mb-3">
                            <div class="stat-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <div class="stat-label">Storage Used</div>
                                        <div class="stat-value" id="storage-used">0 GB</div>
                                    </div>
                                    <div class="stat-icon bg-yellow">
                                        <i class="bi bi-hdd"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="row">
                        <div class="col-lg-6 mb-4">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h6 class="m-0">Recent Jobs</h6>
                                    <a href="#" data-section="jobs" class="btn btn-sm btn-primary">View All</a>
                                </div>
                                <div class="card-body">
                                    <div id="recent-activity-jobs">
                                        <!-- Populated by JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6 mb-4">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h6 class="m-0">Need a Hand?</h6>
                                </div>
                                <div class="card-body">
                                    <p class="mb-2">Tubarr focuses on converting the videos you pick—nothing more to manage.</p>
                                    <ul class="tip-list mb-0">
                                        <li>Hover over form labels to see extra details where available.</li>
                                        <li>Use descriptive show names so you can recognise downloads later.</li>
                                        <li>Jump into <strong>Settings</strong> to set default quality before starting big jobs.</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Subscriptions Section -->
                <section id="subscriptions" class="content-section">
                    <div class="d-flex justify-content-between align-items-start mb-4">
                        <div>
                            <h2>Subscriptions</h2>
                            <p class="text-gray-400">Manage channel subscriptions with automated downloads and retention</p>
                        </div>
                        <button class="btn btn-secondary" id="check-subscriptions">
                            <i class="bi bi-arrow-clockwise"></i>
                            Check All for Updates
                        </button>
                    </div>

                    <div class="tip-callout" data-tip-id="subscriptions">
                        <div class="tip-icon">
                            <i class="bi bi-bell"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-2">Subscription Tips</h6>
                            <div class="tip-content">
                                <ul class="tip-list mb-0">
                                    <li>Add the official channel URL so Tubarr can spot new uploads reliably.</li>
                                    <li>Use retention rules to avoid filling your storage with old episodes.</li>
                                    <li>Click "Check All for Updates" whenever you want to trigger downloads on demand.</li>
                                </ul>
                            </div>
                        </div>
                        <button class="tip-toggle" aria-label="Toggle tip">
                            <i class="bi bi-chevron-up"></i>
                        </button>
                    </div>

                    <div id="subscriptions-container">
                        <!-- Populated by JavaScript with subscription cards -->
                    </div>

                    <!-- Add Subscription Form -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <h6 class="m-0">Subscribe to Channel</h6>
                        </div>
                        <div class="card-body">
                            <form id="subscription-form">
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="channel_url" class="form-label">YouTube Channel URL</label>
                                        <input type="text" class="form-control" id="channel_url" placeholder="https://youtube.com/@channel" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="subscription_show_name" class="form-label">TV Show Name</label>
                                        <input type="text" class="form-control" id="subscription_show_name" placeholder="Show Name" required>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="retention_type" class="form-label">Retention Policy</label>
                                        <select class="form-select" id="retention_type">
                                            <option value="keep_all" selected>Keep all episodes</option>
                                            <option value="keep_episodes">Keep last X episodes</option>
                                            <option value="keep_days">Keep episodes from last X days</option>
                                        </select>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="retention_value" class="form-label">Retention Value</label>
                                        <input type="number" class="form-control" id="retention_value" min="1" disabled>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">Subscribe</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- New TV Download Section -->
                <section id="new-job" class="content-section">
                    <h2>New TV Download</h2>

                    <div class="tip-callout" data-tip-id="new-tv">
                        <div class="tip-icon">
                            <i class="bi bi-collection-play"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-2">Before You Start</h6>
                            <div class="tip-content">
                                <ul class="tip-list mb-0">
                                    <li>Grab the playlist URL from YouTube and double-check it plays in your region.</li>
                                    <li>Set the correct season and episode numbers so Jellyfin sorts your files automatically.</li>
                                    <li>Keep "Track playlist for updates" on to fetch new episodes when they arrive.</li>
                                </ul>
                            </div>
                        </div>
                        <button class="tip-toggle" aria-label="Toggle tip">
                            <i class="bi bi-chevron-up"></i>
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h6 class="m-0">Add New YouTube Playlist</h6>
                        </div>
                        <div class="card-body">
                            <form id="new-job-form">
                                <div class="row mb-3">
                                    <div class="col-lg-10">
                                        <label for="playlist_url" class="form-label">YouTube Playlist URL</label>
                                        <input type="text" class="form-control" id="playlist_url" placeholder="https://youtube.com/playlist?list=..." required
                                               data-bs-toggle="tooltip" title="Paste the full YouTube playlist URL. Make sure the playlist is public or unlisted.">
                                    </div>
                                    <div class="col-lg-2 d-flex align-items-end">
                                        <button type="button" class="btn btn-secondary w-100" id="select-start-btn">Choose Start Video</button>
                                    </div>
                                </div>
                                <input type="hidden" id="playlist_start">

                                <div class="row mb-3">
                                    <div class="col-lg-4">
                                        <label for="show_name" class="form-label">TV Show Name</label>
                                        <input type="text" class="form-control" id="show_name" placeholder="Show Name" required
                                               data-bs-toggle="tooltip" title="This will be the folder name in your media library. Use a name that matches your media server's naming convention.">
                                    </div>
                                    <div class="col-lg-4">
                                        <label for="season_num" class="form-label">Season Number</label>
                                        <input type="text" class="form-control" id="season_num" placeholder="01" pattern="[0-9]+" required
                                               data-bs-toggle="tooltip" title="Season number for this playlist. Use leading zeros (e.g., 01, 02) for proper sorting.">
                                    </div>
                                    <div class="col-lg-4">
                                        <label for="episode_start" class="form-label">Episode Start Number</label>
                                        <input type="text" class="form-control" id="episode_start" placeholder="01" pattern="[0-9]+" required
                                               data-bs-toggle="tooltip" title="Starting episode number. The first video in the playlist will be this episode number.">
                                    </div>
                                    <div class="col-lg-4 d-flex align-items-end">
                                        <div class="form-check form-switch mt-3">
                                            <input class="form-check-input" type="checkbox" id="auto_detect_episodes">
                                            <label class="form-check-label" for="auto_detect_episodes">Auto-detect with TVDB</label>
                                        </div>
                                        <input type="hidden" id="detection_profile" value="airdate">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="track_playlist" checked>
                                        <label class="form-check-label" for="track_playlist">Track playlist for updates</label>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="use_h265" checked>
                                        <label class="form-check-label" for="use_h265">Convert to H.265 (Recommended for smaller file size)</label>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="send_to_sonarr">
                                        <label class="form-check-label" for="send_to_sonarr">Send to Sonarr for processing</label>
                                        <div class="form-text">Uses the Sonarr blackhole directory configured in Settings.</div>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <label for="quality" class="form-label">Maximum Video Quality</label>
                                        <select class="form-select" id="quality">
                                            <option value="2160">4K (2160p)</option>
                                            <option value="1440">QHD (1440p)</option>
                                            <option value="1080" selected>FHD (1080p)</option>
                                            <option value="720">HD (720p)</option>
                                            <option value="480">SD (480p)</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="crf" class="form-label">H.265 Quality (CRF): <span id="crf-value">28</span></label>
                                        <input type="range" class="form-range" min="18" max="32" step="1" id="crf" value="28">
                                        <div class="d-flex justify-content-between">
                                            <small>Higher Quality</small>
                                            <small>Smaller Size</small>
                                        </div>
                                    </div>
                                </div>

                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">Start Download</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- New Movie Section -->
                <section id="new-movie" class="content-section">
                    <h2>New Movie Download</h2>

                    <div class="tip-callout" data-tip-id="new-movie">
                        <div class="tip-icon">
                            <i class="bi bi-film"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-2">Movie Download Tips</h6>
                            <div class="tip-content">
                                <ul class="tip-list mb-0">
                                    <li>Paste either a single movie URL or a playlist containing the full film.</li>
                                    <li>Pick a clear movie name—this becomes the folder and filename when processing completes.</li>
                                    <li>Monitor the Jobs tab to see when your transcode finishes.</li>
                                </ul>
                            </div>
                        </div>
                        <button class="tip-toggle" aria-label="Toggle tip">
                            <i class="bi bi-chevron-up"></i>
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h6 class="m-0">Add Movie from YouTube</h6>
                        </div>
                        <div class="card-body">
                            <form id="new-movie-form">
                                <div class="mb-3">
                                    <label for="movie_url" class="form-label">Movie or Playlist URL</label>
                                    <input type="text" class="form-control" id="movie_url" placeholder="https://youtube.com/watch?v=..." required
                                           data-bs-toggle="tooltip" title="Enter a single video URL or a playlist URL containing the full movie.">
                                </div>
                                <div class="mb-3">
                                    <label for="movie_name" class="form-label">Movie Name</label>
                                    <input type="text" class="form-control" id="movie_name" placeholder="Movie Name" required
                                           data-bs-toggle="tooltip" title="The name of the movie. This will be used for the folder and file name.">
                                </div>
                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="movie_use_h265" checked>
                                        <label class="form-check-label" for="movie_use_h265">Convert to H.265 (Recommended for smaller file size)</label>
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="send_to_radarr">
                                        <label class="form-check-label" for="send_to_radarr">Send to Radarr for processing</label>
                                        <div class="form-text">Uses the Radarr blackhole directory configured in Settings.</div>
                                    </div>
                                </div>
                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <label for="movie_quality" class="form-label">Maximum Video Quality</label>
                                        <select class="form-select" id="movie_quality">
                                            <option value="2160">4K (2160p)</option>
                                            <option value="1440">QHD (1440p)</option>
                                            <option value="1080" selected>FHD (1080p)</option>
                                            <option value="720">HD (720p)</option>
                                            <option value="480">SD (480p)</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="movie_crf" class="form-label">H.265 Quality (CRF): <span id="movie-crf-value">28</span></label>
                                        <input type="range" class="form-range" min="18" max="32" step="1" id="movie_crf" value="28">
                                        <div class="d-flex justify-content-between">
                                            <small>Higher Quality</small>
                                            <small>Smaller Size</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">Start Download</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- New Music Section -->
                <section id="new-music" class="content-section">
                    <h2>New Music Download</h2>

                    <div class="tip-callout" data-tip-id="new-music">
                        <div class="tip-icon">
                            <i class="bi bi-music-note-beamed"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-2">Music Workflow Tips</h6>
                            <div class="tip-content">
                                <ul class="tip-list mb-0">
                                    <li>Use the tabs below to switch between single tracks, albums, or playlists.</li>
                                    <li>Fetch metadata first to pre-fill titles and artwork before you fine-tune tags.</li>
                                    <li>Embed cover art to make tracks look great on Jellyfin and other players.</li>
                                </ul>
                            </div>
                        </div>
                        <button class="tip-toggle" aria-label="Toggle tip">
                            <i class="bi bi-chevron-up"></i>
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
                                <h6 class="m-0">Create Music Jobs</h6>
                                <div class="text-muted small">
                                    Fetch playlist metadata, adjust tags, and queue downloads for individual tracks, albums, or curated playlists.
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs" id="musicJobTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="music-single-tab" data-bs-toggle="tab" data-bs-target="#music-single" type="button" role="tab" aria-controls="music-single" aria-selected="true">
                                        <i class="bi bi-music-note"></i> Single Track
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="music-album-tab" data-bs-toggle="tab" data-bs-target="#music-album" type="button" role="tab" aria-controls="music-album" aria-selected="false">
                                        <i class="bi bi-disc"></i> Album
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="music-playlist-tab" data-bs-toggle="tab" data-bs-target="#music-playlist" type="button" role="tab" aria-controls="music-playlist" aria-selected="false">
                                        <i class="bi bi-collection-music"></i> Playlist &amp; Mixes
                                    </button>
                                </li>
                            </ul>

                            <div class="tab-content mt-4" id="musicJobTabContent">
                                <div class="tab-pane fade show active" id="music-single" role="tabpanel" aria-labelledby="music-single-tab">
                                    <form id="music-single-form" class="music-job-form">
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <label for="music_single_url" class="form-label">Track URL</label>
                                                <input type="url" class="form-control" id="music_single_url" placeholder="https://youtube.com/watch?v=..." required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="music_single_title" class="form-label">Track Title</label>
                                                <input type="text" class="form-control" id="music_single_title" placeholder="Song Title" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="music_single_artist" class="form-label">Artist</label>
                                                <input type="text" class="form-control" id="music_single_artist" placeholder="Artist or Band" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="music_single_album" class="form-label">Album / Collection</label>
                                                <input type="text" class="form-control" id="music_single_album" placeholder="Album or Collection Name">
                                            </div>
                                            <div class="col-md-3">
                                                <label for="music_single_year" class="form-label">Year</label>
                                                <input type="number" min="1900" max="2100" class="form-control" id="music_single_year" placeholder="2024">
                                            </div>
                                            <div class="col-md-3">
                                                <label for="music_single_track" class="form-label">Track #</label>
                                                <input type="number" min="1" class="form-control" id="music_single_track" placeholder="1">
                                            </div>
                                            <div class="col-md-3">
                                                <label for="music_single_disc" class="form-label">Disc #</label>
                                                <input type="number" min="1" class="form-control" id="music_single_disc" placeholder="1">
                                            </div>
                                            <div class="col-md-3">
                                                <label for="music_single_genres" class="form-label">Genres</label>
                                                <input type="text" class="form-control" id="music_single_genres" placeholder="Rock; Alternative">
                                                <div class="form-text">Separate multiple genres with semicolons.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="music_single_tags" class="form-label">Custom Tags</label>
                                                <input type="text" class="form-control" id="music_single_tags" placeholder="mood=chill;language=en">
                                                <div class="form-text">Use <code>key=value</code> pairs separated by semicolons.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="music_single_cover" class="form-label">Cover Art URL (optional)</label>
                                                <input type="url" class="form-control" id="music_single_cover" placeholder="https://.../cover.jpg">
                                            </div>
                                        </div>
                                        <div class="text-end mt-4">
                                            <button type="submit" class="btn btn-primary" id="music-single-submit">
                                                <i class="bi bi-cloud-arrow-down"></i> Queue Track
                                            </button>
                                        </div>
                                    </form>
                                </div>

                                <div class="tab-pane fade" id="music-album" role="tabpanel" aria-labelledby="music-album-tab">
                                    <form id="music-album-form" class="music-job-form">
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <label for="music_album_url" class="form-label">Album or Playlist URL</label>
                                                <div class="input-group">
                                                    <input type="url" class="form-control" id="music_album_url" placeholder="https://youtube.com/playlist?list=..." required>
                                                    <button class="btn btn-outline-secondary" type="button" id="music_album_fetch">
                                                        <i class="bi bi-search"></i> Fetch Metadata
                                                    </button>
                                                </div>
                                                <div class="form-text">Use any playlist URL that represents the album tracks.</div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="music_album_title" class="form-label">Album Title</label>
                                                <input type="text" class="form-control" id="music_album_title" placeholder="Album Title" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="music_album_artist" class="form-label">Album Artist</label>
                                                <input type="text" class="form-control" id="music_album_artist" placeholder="Primary Artist" required>
                                            </div>
                                            <div class="col-md-3">
                                                <label for="music_album_year" class="form-label">Release Year</label>
                                                <input type="number" min="1900" max="2100" class="form-control" id="music_album_year" placeholder="2024">
                                            </div>
                                            <div class="col-md-3">
                                                <label for="music_album_genre" class="form-label">Genres</label>
                                                <input type="text" class="form-control" id="music_album_genre" placeholder="Pop; Dance">
                                            </div>
                                            <div class="col-md-6">
                                                <label for="music_album_cover" class="form-label">Cover Art URL</label>
                                                <input type="url" class="form-control" id="music_album_cover" placeholder="https://.../cover.jpg">
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Track Listing</label>
                                                <div class="table-responsive" id="music-album-tracks">
                                                    <p class="text-muted mb-0">Fetch metadata to populate track information or add tracks manually.</p>
                                                </div>
                                            </div>
                                            <div class="col-12 d-flex justify-content-between align-items-center">
                                                <button type="button" class="btn btn-outline-secondary" id="music_album_add_track">
                                                    <i class="bi bi-plus-circle"></i> Add Track
                                                </button>
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="music_album_embed_cover" checked>
                                                    <label class="form-check-label" for="music_album_embed_cover">Embed cover art into files</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-end mt-4">
                                            <button type="submit" class="btn btn-primary" id="music-album-submit">
                                                <i class="bi bi-cloud-arrow-down"></i> Queue Album
                                            </button>
                                        </div>
                                    </form>
                                </div>

                                <div class="tab-pane fade" id="music-playlist" role="tabpanel" aria-labelledby="music-playlist-tab">
                                    <form
                                        id="music-playlist-form"
                                        class="music-job-form"
                                        data-music-output-dir="{{ music_defaults.music_output_dir | default('') }}"
                                        data-jellyfin-music-path="{{ music_defaults.jellyfin_music_path | default('') }}"
                                    >
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <label for="music_playlist_url" class="form-label">Playlist URL</label>
                                                <div class="input-group">
                                                    <input type="url" class="form-control" id="music_playlist_url" placeholder="https://youtube.com/playlist?list=..." required>
                                                    <button class="btn btn-outline-secondary" type="button" id="music_playlist_fetch">
                                                        <i class="bi bi-search"></i> Inspect Playlist
                                                    </button>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="music_playlist_title" class="form-label">Collection Name</label>
                                                <input type="text" class="form-control" id="music_playlist_title" placeholder="Playlist or Mix Name" required>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="music_playlist_owner" class="form-label">Owner / Curator</label>
                                                <input type="text" class="form-control" id="music_playlist_owner" placeholder="Channel or Curator">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="music_playlist_variant" class="form-label">Playlist Type</label>
                                                <select id="music_playlist_variant" class="form-select">
                                                    <option value="standard" selected>Standard Playlist</option>
                                                    <option value="mix">YouTube Mix</option>
                                                    <option value="channel">Channel Uploads</option>
                                                    <option value="artist">Artist Radio</option>
                                                </select>
                                            </div>
                                            <div class="col-md-4">
                                                <label for="music_playlist_limit" class="form-label">Track Limit</label>
                                                <input type="number" min="1" class="form-control" id="music_playlist_limit" placeholder="All">
                                            </div>
                                            <div class="col-md-4">
                                                <label for="music_playlist_cover" class="form-label">Cover Art URL</label>
                                                <input type="url" class="form-control" id="music_playlist_cover" placeholder="https://.../cover.jpg">
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Playlist Tracks</label>
                                                <div class="table-responsive" id="music-playlist-tracks">
                                                    <p class="text-muted mb-0">Inspect the playlist to load tracks. You can edit tags for each track.</p>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-check form-switch">
                                                    <input class="form-check-input" type="checkbox" id="music_playlist_create_m3u">
                                                    <label class="form-check-label" for="music_playlist_create_m3u">
                                                        Create M3U playlist
                                                    </label>
                                                </div>
                                                <div class="mt-2" id="music-playlist-m3u-group">
                                                    <label for="music_playlist_m3u_path" class="form-label">Playlist output directory</label>
                                                    <input type="text" class="form-control" id="music_playlist_m3u_path" placeholder="/path/to/playlists">
                                                    <div class="form-text">The .m3u file will be created alongside the downloaded tracks.</div>
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="music_playlist_include_future" checked>
                                                    <label class="form-check-label" for="music_playlist_include_future">
                                                        Track this playlist for future additions
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-end mt-4">
                                            <button type="submit" class="btn btn-primary" id="music-playlist-submit">
                                                <i class="bi bi-cloud-arrow-down"></i> Queue Playlist
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- New Audiobook Section -->
                <section id="new-audiobook" class="content-section">
                    <h2>New Audiobook Download</h2>

                    <div class="tip-callout" data-tip-id="new-audiobook">
                        <div class="tip-icon">
                            <i class="bi bi-journal-richtext"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-2">Audiobook Workflow Tips</h6>
                            <div class="tip-content">
                                <ul class="tip-list mb-0">
                                    <li>Each request processes a single book to keep conversions predictable.</li>
                                    <li>We save finished <code>.m4b</code> files to <code>/mnt/storage/audiobooks</code> by default.</li>
                                    <li>Cover art is fetched from Google Books when possible and embedded into the final file.</li>
                                </ul>
                            </div>
                        </div>
                        <button class="tip-toggle" aria-label="Toggle tip">
                            <i class="bi bi-chevron-up"></i>
                        </button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h6 class="m-0">Create Audiobook Job</h6>
                        </div>
                        <div class="card-body">
                            <form id="audiobook-form" class="row g-3">
                                <div class="col-12">
                                    <label for="audiobook_url" class="form-label">Source URL</label>
                                    <input type="url" class="form-control" id="audiobook_url" placeholder="https://youtube.com/watch?v=..." required>
                                    <div class="form-text">Provide the URL that contains the audiobook audio.</div>
                                </div>
                                <div class="col-md-6">
                                    <label for="audiobook_title" class="form-label">Book Title</label>
                                    <input type="text" class="form-control" id="audiobook_title" placeholder="Book title" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="audiobook_author" class="form-label">Author</label>
                                    <input type="text" class="form-control" id="audiobook_author" placeholder="Author name" required>
                                </div>
                                <div class="col-12">
                                    <label for="audiobook_cover" class="form-label">Custom Cover URL (optional)</label>
                                    <input type="url" class="form-control" id="audiobook_cover" placeholder="https://.../cover.jpg">
                                    <div class="form-text">If left blank, the downloader will try to fetch artwork from Google Books.</div>
                                </div>
                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary" id="audiobook-submit">Start Download</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Jobs Section -->
                <section id="jobs" class="content-section">
                    <h2>Download Jobs</h2>

                    <div class="tip-callout" data-tip-id="jobs">
                        <div class="tip-icon">
                            <i class="bi bi-activity"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-2">Tracking Jobs</h6>
                            <div class="tip-content">
                                <ul class="tip-list mb-0">
                                    <li>Filter the queue with the buttons below to focus on TV, movies, or music.</li>
                                    <li>Use the action menu on each job to retry or cancel items if something stalls.</li>
                                    <li>Completed jobs move to the History tab automatically for safekeeping.</li>
                                </ul>
                            </div>
                        </div>
                        <button class="tip-toggle" aria-label="Toggle tip">
                            <i class="bi bi-chevron-up"></i>
                        </button>
                    </div>

                    <div class="d-flex justify-content-end mb-3">
                        <div class="btn-group btn-group-sm" role="group" id="job-type-filter" aria-label="Job type filter">
                            <button type="button" class="btn btn-outline-primary active" data-job-filter="all">
                                <i class="bi bi-collection"></i> All
                            </button>
                            <button type="button" class="btn btn-outline-primary" data-job-filter="tv">
                                <i class="bi bi-tv"></i> TV
                            </button>
                            <button type="button" class="btn btn-outline-primary" data-job-filter="movie">
                                <i class="bi bi-film"></i> Movies
                            </button>
                            <button type="button" class="btn btn-outline-primary" data-job-filter="music">
                                <i class="bi bi-music-note-beamed"></i> Music
                            </button>
                            <button type="button" class="btn btn-outline-primary" data-job-filter="audiobook">
                                <i class="bi bi-journal-richtext"></i> Audiobooks
                            </button>
                        </div>
                    </div>

                    <div class="card mb-4 job-panel" data-job-type="tv">
                        <div class="card-header">
                            <h6 class="m-0">Active TV Jobs</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table" id="jobs-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Show</th>
                                            <th>Season</th>
                                            <th>Status</th>
                                            <th>Progress</th>
                                            <th>Created</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card job-panel" data-job-type="movie">
                        <div class="card-header">
                            <h6 class="m-0">Active Movie Jobs</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table" id="movie-jobs-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Movie</th>
                                            <th>Status</th>
                                            <th>Progress</th>
                                            <th>Created</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4 job-panel" data-job-type="music">
                        <div class="card-header">
                            <h6 class="m-0">Active Music Jobs</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table" id="music-jobs-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Collection</th>
                                            <th>Type</th>
                                            <th>Status</th>
                                            <th>Progress</th>
                                            <th>Created</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4 job-panel" data-job-type="audiobook">
                        <div class="card-header">
                            <h6 class="m-0">Active Audiobook Jobs</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table" id="audiobook-jobs-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Title</th>
                                            <th>Author</th>
                                            <th>Status</th>
                                            <th>Progress</th>
                                            <th>Created</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- History Section -->
                <section id="history" class="content-section">
                    <h2>History</h2>

                    <div class="tip-callout" data-tip-id="history">
                        <div class="tip-icon">
                            <i class="bi bi-archive"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-2">History Tips</h6>
                            <div class="tip-content">
                                <ul class="tip-list mb-0">
                                    <li>Filter by media type to confirm exactly what finished and when.</li>
                                    <li>Use the action buttons to re-queue a past download without re-entering details.</li>
                                    <li>History is trimmed automatically based on the limit you set under Settings.</li>
                                </ul>
                            </div>
                        </div>
                        <button class="tip-toggle" aria-label="Toggle tip">
                            <i class="bi bi-chevron-up"></i>
                        </button>
                    </div>

                    <div class="d-flex justify-content-end mb-3">
                        <div class="btn-group btn-group-sm" role="group" id="history-type-filter" aria-label="History type filter">
                            <button type="button" class="btn btn-outline-secondary active" data-history-filter="all">
                                <i class="bi bi-collection"></i> All
                            </button>
                            <button type="button" class="btn btn-outline-secondary" data-history-filter="tv">
                                <i class="bi bi-tv"></i> TV
                            </button>
                            <button type="button" class="btn btn-outline-secondary" data-history-filter="movie">
                                <i class="bi bi-film"></i> Movies
                            </button>
                            <button type="button" class="btn btn-outline-secondary" data-history-filter="music">
                                <i class="bi bi-music-note-beamed"></i> Music
                            </button>
                            <button type="button" class="btn btn-outline-secondary" data-history-filter="audiobook">
                                <i class="bi bi-journal-richtext"></i> Audiobooks
                            </button>
                        </div>
                    </div>

                    <div class="card mb-4 history-panel" data-history-type="tv">
                        <div class="card-header">
                            <h6 class="m-0">Past TV Jobs</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table" id="history-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Show</th>
                                            <th>Season</th>
                                            <th>Status</th>
                                            <th>Progress</th>
                                            <th>Created</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card history-panel" data-history-type="movie">
                        <div class="card-header">
                            <h6 class="m-0">Movie History</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table" id="movie-history-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Movie</th>
                                            <th>Status</th>
                                            <th>Progress</th>
                                            <th>Created</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4 history-panel" data-history-type="music">
                        <div class="card-header">
                            <h6 class="m-0">Music History</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table" id="music-history-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Collection</th>
                                            <th>Type</th>
                                            <th>Status</th>
                                            <th>Progress</th>
                                            <th>Completed</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card mt-4 history-panel" data-history-type="audiobook">
                        <div class="card-header">
                            <h6 class="m-0">Audiobook History</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table" id="audiobook-history-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Book</th>
                                            <th>Author</th>
                                            <th>Status</th>
                                            <th>Progress</th>
                                            <th>Completed</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Settings Section -->
                <section id="settings" class="content-section">
                    <h2>Settings</h2>

                    <div class="tip-callout">
                        <div class="tip-icon">
                            <i class="bi bi-gear"></i>
                        </div>
                        <div>
                            <h6 class="mb-2">Settings Tips</h6>
                            <ul class="tip-list mb-0">
                                <li>Choose your default download folder and video quality before kicking off large jobs.</li>
                                <li>Enable Jellyfin syncing only if you have an API key ready—otherwise leave it off.</li>
                                <li>Adjust the concurrent transcodes slider based on your hardware capabilities.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h6 class="m-0">Application Settings</h6>
                        </div>
                        <div class="card-body">
                            <form id="settings-form">
                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <label for="output_dir" class="form-label">Output Directory</label>
                                        <input type="text" class="form-control" id="output_dir">
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="cookies_path" class="form-label">Cookies File Path</label>
                                        <input type="text" class="form-control" id="cookies_path">
                                        <div class="form-text">Optional: Path to cookies file for authenticated content</div>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <label for="sonarr_blackhole_path" class="form-label">Sonarr Blackhole Directory</label>
                                        <input type="text" class="form-control" id="sonarr_blackhole_path" placeholder="/path/to/sonarr/blackhole">
                                        <div class="form-text">Used when "Send to Sonarr" is enabled on TV downloads.</div>
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="radarr_blackhole_path" class="form-label">Radarr Blackhole Directory</label>
                                        <input type="text" class="form-control" id="radarr_blackhole_path" placeholder="/path/to/radarr/blackhole">
                                        <div class="form-text">Used when "Send to Radarr" is enabled on movie downloads.</div>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <label for="default_quality" class="form-label">Default Video Quality</label>
                                        <select class="form-select" id="default_quality">
                                            <option value="2160">4K (2160p)</option>
                                            <option value="1440">QHD (1440p)</option>
                                            <option value="1080" selected>FHD (1080p)</option>
                                            <option value="720">HD (720p)</option>
                                            <option value="480">SD (480p)</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="default_crf" class="form-label">Default H.265 Quality (CRF): <span id="default-crf-value">28</span></label>
                                        <input type="range" class="form-range" min="18" max="32" step="1" id="default_crf" value="28">
                                        <div class="d-flex justify-content-between">
                                            <small>Higher Quality</small>
                                            <small>Smaller Size</small>
                                        </div>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="default_use_h265" checked>
                                            <label class="form-check-label" for="default_use_h265">Convert to H.265 by default</label>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="clean_filenames" checked>
                                            <label class="form-check-label" for="clean_filenames">Clean filenames</label>
                                        </div>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <label for="max_concurrent_jobs" class="form-label">Concurrent Transcodes: <span id="max-concurrent-value">1</span></label>
                                        <input type="range" class="form-range" min="1" max="4" step="1" id="max_concurrent_jobs" value="1">
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="web_port" class="form-label">Web Interface Port</label>
                                        <input type="number" class="form-control" id="web_port" min="1" max="65535" value="8000">
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <label for="completed_jobs_limit" class="form-label">Completed Jobs to Keep</label>
                                        <input type="number" class="form-control" id="completed_jobs_limit" min="1" max="100" value="10">
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="update_interval" class="form-label">Check Interval (minutes)</label>
                                        <input type="number" class="form-control" id="update_interval" min="5" value="60">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="auto_check_updates">
                                        <label class="form-check-label" for="auto_check_updates">Automatically check playlists for updates</label>
                                    </div>
                                </div>

                                <h6 class="mt-4 mb-3">Metadata Providers</h6>

                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="imdb_enabled">
                                        <label class="form-check-label" for="imdb_enabled">Use IMDb for movie metadata</label>
                                    </div>
                                </div>

                                <div class="row mb-3 imdb-settings">
                                    <div class="col-lg-6">
                                        <label for="imdb_api_key" class="form-label">IMDb API Key</label>
                                        <input type="text" class="form-control" id="imdb_api_key">
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <label for="tmdb_api_key" class="form-label">TMDb API Key</label>
                                        <input type="text" class="form-control" id="tmdb_api_key">
                                        <div class="form-text">For movie metadata and artwork</div>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <label for="tvdb_api_key" class="form-label">TVDB API Key</label>
                                        <input type="text" class="form-control" id="tvdb_api_key">
                                        <div class="form-text">Required for auto-detecting episodes by air date</div>
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="tvdb_pin" class="form-label">TVDB PIN (Optional)</label>
                                        <input type="text" class="form-control" id="tvdb_pin">
                                        <div class="form-text">Only required if your TVDB API key uses a PIN</div>
                                    </div>
                                </div>

                                <h6 class="mt-4 mb-3">Jellyfin Integration</h6>

                                <div class="mb-3">
                                    <div class="form-check form-switch">
                                        <input class="form-check-input" type="checkbox" id="jellyfin_enabled">
                                        <label class="form-check-label" for="jellyfin_enabled">Enable Jellyfin integration</label>
                                    </div>
                                </div>

                                <div class="row mb-3 jellyfin-settings">
                                    <div class="col-lg-12">
                                        <label for="jellyfin_tv_path" class="form-label">Jellyfin TV Library Path</label>
                                        <input type="text" class="form-control" id="jellyfin_tv_path" placeholder="/path/to/jellyfin/tv">
                                    </div>
                                </div>

                                <div class="row mb-3 jellyfin-settings">
                                    <div class="col-lg-4">
                                        <label for="jellyfin_host" class="form-label">Jellyfin Host</label>
                                        <input type="text" class="form-control" id="jellyfin_host" placeholder="localhost">
                                    </div>
                                    <div class="col-lg-4">
                                        <label for="jellyfin_port" class="form-label">Jellyfin Port</label>
                                        <input type="text" class="form-control" id="jellyfin_port" value="8096">
                                    </div>
                                    <div class="col-lg-4">
                                        <label for="jellyfin_api_key" class="form-label">API Key</label>
                                        <input type="text" class="form-control" id="jellyfin_api_key">
                                    </div>
                                </div>

                                <div class="text-end">
                                    <button type="submit" class="btn btn-primary">Save Settings</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Music Track Edit Modal -->
    <div class="modal fade" id="musicTrackModal" tabindex="-1" aria-labelledby="musicTrackModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="musicTrackModalLabel">
                        <i class="bi bi-music-note-beamed"></i> Edit Track Metadata
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="music-track-form">
                        <input type="hidden" id="music_track_index">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label for="music_track_title" class="form-label">Title</label>
                                <input type="text" class="form-control" id="music_track_title" required>
                            </div>
                            <div class="col-md-6">
                                <label for="music_track_artist" class="form-label">Artist</label>
                                <input type="text" class="form-control" id="music_track_artist" required>
                            </div>
                            <div class="col-md-6">
                                <label for="music_track_album" class="form-label">Album</label>
                                <input type="text" class="form-control" id="music_track_album">
                            </div>
                            <div class="col-md-3">
                                <label for="music_track_year" class="form-label">Year</label>
                                <input type="number" min="1900" max="2100" class="form-control" id="music_track_year">
                            </div>
                            <div class="col-md-3">
                                <label for="music_track_number" class="form-label">Track #</label>
                                <input type="number" min="1" class="form-control" id="music_track_number">
                            </div>
                            <div class="col-md-3">
                                <label for="music_track_disc" class="form-label">Disc #</label>
                                <input type="number" min="1" class="form-control" id="music_track_disc">
                            </div>
                            <div class="col-md-3">
                                <label for="music_track_duration" class="form-label">Duration (s)</label>
                                <input type="number" min="0" class="form-control" id="music_track_duration" placeholder="180">
                            </div>
                            <div class="col-md-6">
                                <label for="music_track_genres" class="form-label">Genres</label>
                                <input type="text" class="form-control" id="music_track_genres" placeholder="Rock; Indie">
                            </div>
                            <div class="col-md-6">
                                <label for="music_track_tags" class="form-label">Custom Tags</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="music_track_tags" placeholder="mood=energetic;language=en">
                                    <button class="btn btn-outline-secondary" type="button" id="music_track_manage_tags">
                                        <i class="bi bi-tags"></i>
                                    </button>
                                </div>
                                <div class="form-text">Use <code>key=value</code> pairs separated by semicolons or open the tag editor.</div>
                            </div>
                            <div class="col-12">
                                <label for="music_track_notes" class="form-label">Notes</label>
                                <textarea class="form-control" id="music_track_notes" rows="2" placeholder="Optional notes for this track"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="music_track_save">
                        <i class="bi bi-save"></i> Save Track
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Music Tag Modal -->
    <div class="modal fade" id="musicTagModal" tabindex="-1" aria-labelledby="musicTagModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="musicTagModalLabel">
                        <i class="bi bi-tags"></i> Edit Custom Tags
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="music_tag_key" class="form-label">Tag Key</label>
                        <input type="text" class="form-control" id="music_tag_key" placeholder="mood">
                    </div>
                    <div class="mb-3">
                        <label for="music_tag_value" class="form-label">Tag Value</label>
                        <input type="text" class="form-control" id="music_tag_value" placeholder="upbeat">
                    </div>
                    <div class="form-text">Use the add button to append tags to the current track. Existing tags will be displayed below.</div>
                    <ul class="list-group mt-3" id="music_tag_list"></ul>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="music_tag_add">
                        <i class="bi bi-plus-lg"></i> Add Tag
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Playlist Start Modal -->
    <div class="modal fade" id="playlistStartModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Select Starting Video</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="playlist-videos-container" style="max-height:400px; overflow-y:auto;"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="confirm-start-video">Confirm</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Subscription Edit Modal -->
    <div class="modal fade" id="subscriptionEditModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="subscription-edit-form">
                    <div class="modal-header">
                        <h5 class="modal-title">Edit Subscription</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="edit_subscription_show_name" class="form-label">TV Show Name</label>
                            <input type="text" class="form-control" id="edit_subscription_show_name" required>
                        </div>
                        <div class="mb-3">
                            <label for="edit_retention_type" class="form-label">Retention Policy</label>
                            <select class="form-select" id="edit_retention_type">
                                <option value="keep_all">Keep all episodes</option>
                                <option value="keep_episodes">Keep last X episodes</option>
                                <option value="keep_days">Keep episodes from last X days</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="edit_retention_value" class="form-label">Retention Value</label>
                            <input type="number" class="form-control" id="edit_retention_value" min="1" disabled>
                        </div>
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="edit_subscription_enabled" checked>
                            <label class="form-check-label" for="edit_subscription_enabled">Download new episodes</label>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Job Detail Modal -->
    <div class="modal fade" id="jobDetailModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Job Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <p><strong>Show:</strong> <span id="detail-show-name"></span></p>
                            <p><strong>Season:</strong> <span id="detail-season"></span></p>
                            <p><strong>Episode Start:</strong> <span id="detail-episode-start"></span></p>
                            <p id="detail-movie-field" style="display:none;"><strong>Movie:</strong> <span id="detail-movie-name"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Status:</strong> <span id="detail-status" class="badge"></span></p>
                            <p><strong>Created:</strong> <span id="detail-created"></span></p>
                            <p><strong>Updated:</strong> <span id="detail-updated"></span></p>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-12">
                            <p><strong>Playlist URL:</strong> <a href="#" id="detail-url" target="_blank"></a></p>
                        </div>
                    </div>

                    <div class="alert alert-info mb-3">
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <span id="detail-stage-icon" class="fs-4">
                                    <i class="bi bi-arrow-repeat"></i>
                                </span>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-0"><span id="detail-stage-name">Processing</span></h6>
                                <div id="detail-status-text">Working on files...</div>
                                <div class="d-flex justify-content-between align-items-center mt-1">
                                    <div>
                                        <span id="detail-file-progress">0</span> / <span id="detail-file-total">0</span> files
                                    </div>
                                    <div id="detail-current-file"></div>
                                </div>
                                <div id="detail-queue" class="small text-muted mt-1"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mb-2">Overall progress:</div>
                    <div class="progress mb-3">
                        <div id="detail-progress-bar" class="progress-bar" role="progressbar" style="width: 0%">0%</div>
                    </div>

                    <div class="mb-2">Stage progress:</div>
                    <div class="progress mb-4">
                        <div id="detail-stage-progress-bar" class="progress-bar bg-info" role="progressbar" style="width: 0%">0%</div>
                    </div>

                    <h6>Log Messages:</h6>
                    <div class="log-container">
                        <pre id="detail-log" class="m-0"></pre>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-danger" id="cancel-job-btn">Cancel Job</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toast-message"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
