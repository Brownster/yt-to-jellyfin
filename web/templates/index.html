<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tubarr</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='favicon.png') }}">
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse">
                <div class="position-sticky pt-3">
                    <div class="text-center mb-4">
                        <h3 class="text-white">Tubarr</h3>
                    </div>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-section="dashboard">
                                <i class="bi bi-speedometer2 me-2"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="new-job">
                                <i class="bi bi-plus-circle me-2"></i> New Download
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="jobs">
                                <i class="bi bi-list-task me-2"></i> Jobs
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="playlists">
                                <i class="bi bi-journal-text me-2"></i> Playlists
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="media">
                                <i class="bi bi-collection-play me-2"></i> Media Library
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="settings">
                                <i class="bi bi-gear me-2"></i> Settings
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <!-- Main content -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- Dashboard Section -->
                <section id="dashboard" class="content-section">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Dashboard</h1>
                    </div>
                    
                    <div class="row">
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-primary shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                                Total Shows</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-shows">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="bi bi-tv fs-2 text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-success shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                                Total Episodes</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="total-episodes">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="bi bi-film fs-2 text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-info shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                                Active Jobs</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="active-jobs">0</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="bi bi-arrow-repeat fs-2 text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-xl-3 col-md-6 mb-4">
                            <div class="card border-left-warning shadow h-100 py-2">
                                <div class="card-body">
                                    <div class="row no-gutters align-items-center">
                                        <div class="col mr-2">
                                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                                Storage Used</div>
                                            <div class="h5 mb-0 font-weight-bold text-gray-800" id="storage-used">0 GB</div>
                                        </div>
                                        <div class="col-auto">
                                            <i class="bi bi-hdd fs-2 text-gray-300"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-4">
                        <div class="col-lg-6">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold">Recent Jobs</h6>
                                    <a href="#" data-section="jobs" class="btn btn-sm btn-primary">View All</a>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="recent-jobs-table">
                                            <thead>
                                                <tr>
                                                    <th>Show</th>
                                                    <th>Season</th>
                                                    <th>Status</th>
                                                    <th>Created</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-lg-6">
                            <div class="card shadow mb-4">
                                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                                    <h6 class="m-0 font-weight-bold">Recent Media</h6>
                                    <a href="#" data-section="media" class="btn btn-sm btn-primary">View All</a>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="recent-media-table">
                                            <thead>
                                                <tr>
                                                    <th>Show</th>
                                                    <th>Season</th>
                                                    <th>Episodes</th>
                                                    <th>Modified</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Will be populated by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                </div>
            </div>
        </section>

        <!-- Playlists Section -->
        <section id="playlists" class="content-section d-none">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Playlists</h1>
                <button class="btn btn-sm btn-outline-secondary" id="check-playlists">
                    <i class="bi bi-arrow-clockwise"></i> Check Updates
                </button>
            </div>
            <div class="table-responsive">
                <table class="table table-hover" id="playlists-table">
                    <thead>
                        <tr>
                            <th>Show</th>
                            <th>Season</th>
                            <th>Last Episode</th>
                            <th>Playlist URL</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </section>
                
                <!-- New Job Section -->
                <section id="new-job" class="content-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">New Download</h1>
                    </div>
                    
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold">Add New YouTube Playlist</h6>
                        </div>
                        <div class="card-body">
                            <form id="new-job-form">
                                <div class="row mb-3">
                                    <div class="col-lg-10">
                                        <label for="playlist_url" class="form-label">YouTube Playlist URL <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="playlist_url" name="playlist_url" placeholder="https://youtube.com/playlist?list=..." required>
                                    </div>
                                    <div class="col-lg-2 d-flex align-items-end">
                                        <button type="button" class="btn btn-secondary w-100" id="select-start-btn">Choose Start Video</button>
                                    </div>
                                </div>
                                <input type="hidden" id="playlist_start" name="playlist_start">
                                
                                <div class="row mb-3">
                                    <div class="col-lg-4">
                                        <label for="show_name" class="form-label">TV Show Name <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="show_name" name="show_name" placeholder="Show Name" required>
                                    </div>
                                    <div class="col-lg-4">
                                        <label for="season_num" class="form-label">Season Number <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="season_num" name="season_num" placeholder="01" pattern="[0-9]+" required>
                                    </div>
                                    <div class="col-lg-4">
                                        <label for="episode_start" class="form-label">Episode Start Number <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" id="episode_start" name="episode_start" placeholder="01" pattern="[0-9]+" required>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-lg-12">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="use_h265" checked>
                                            <label class="form-check-label" for="use_h265">Convert to H.265 (Recommended for smaller file size)</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-lg-4">
                                        <label for="quality" class="form-label">Maximum Video Quality</label>
                                        <select class="form-select" id="quality">
                                            <option value="2160">4K (2160p)</option>
                                            <option value="1440">QHD (1440p)</option>
                                            <option value="1080" selected>FHD (1080p)</option>
                                            <option value="720">HD (720p)</option>
                                            <option value="480">SD (480p)</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-4">
                                        <label for="crf" class="form-label">H.265 Quality (CRF)</label>
                                        <input type="range" class="form-range" min="18" max="32" step="1" id="crf" value="28">
                                        <div class="d-flex justify-content-between">
                                            <small>Higher Quality</small>
                                            <small id="crf-value">28</small>
                                            <small>Smaller Size</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <button type="submit" class="btn btn-primary" id="start-download-btn">Start Download</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- Jobs Section -->
                <section id="jobs" class="content-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Download Jobs</h1>
                    </div>
                    
                    <div class="card shadow mb-4">
                        <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                            <h6 class="m-0 font-weight-bold">All Jobs</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="jobs-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Show</th>
                                            <th>Season</th>
                                            <th>Status</th>
                                            <th>Progress</th>
                                            <th>Created</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Will be populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Job Detail Modal -->
                    <div class="modal fade" id="jobDetailModal" tabindex="-1" aria-labelledby="jobDetailModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="jobDetailModalLabel">Job Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="row mb-3">
                                        <div class="col-md-6">
                                            <p><strong>Show:</strong> <span id="detail-show-name"></span></p>
                                            <p><strong>Season:</strong> <span id="detail-season"></span></p>
                                            <p><strong>Episode Start:</strong> <span id="detail-episode-start"></span></p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>Status:</strong> <span id="detail-status" class="badge"></span></p>
                                            <p><strong>Created:</strong> <span id="detail-created"></span></p>
                                            <p><strong>Updated:</strong> <span id="detail-updated"></span></p>
                                        </div>
                                    </div>
                                    
                                    <div class="row mb-3">
                                        <div class="col-12">
                                            <p><strong>Playlist URL:</strong> <a href="#" id="detail-url" target="_blank"></a></p>
                                        </div>
                                    </div>
                                    
                                    <!-- Detailed status -->
                                    <div class="alert alert-info mb-3">
                                        <div class="d-flex align-items-center">
                                            <div class="me-3">
                                                <span id="detail-stage-icon" class="fs-4">
                                                    <i class="bi bi-arrow-repeat"></i>
                                                </span>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h6 class="mb-0"><span id="detail-stage-name">Processing</span></h6>
                                                <div id="detail-status-text">Working on files...</div>
                                                <div class="d-flex justify-content-between align-items-center mt-1">
                                                    <div>
                                                        <span id="detail-file-progress">0</span> / <span id="detail-file-total">0</span> files
                                                    </div>
                                                    <div id="detail-current-file"></div>
                                                </div>
                                                <div id="detail-queue" class="small text-muted mt-1"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Overall progress -->
                                    <div class="mb-2">Overall progress:</div>
                                    <div class="progress mb-3">
                                        <div id="detail-progress-bar" class="progress-bar" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100">0%</div>
                                    </div>
                                    
                                    <!-- Stage progress -->
                                    <div class="mb-2">Stage progress:</div>
                                    <div class="progress mb-4">
                                        <div id="detail-stage-progress-bar" class="progress-bar bg-info" role="progressbar" style="width: 0%" aria-valuemin="0" aria-valuemax="100">0%</div>
                                    </div>
                                    
                                    <h6>Log Messages:</h6>
                                    <div class="log-container border rounded p-2 bg-light">
                                        <pre id="detail-log" class="m-0" style="max-height: 300px; overflow-y: auto;"></pre>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-danger" id="cancel-job-btn">Cancel Job</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Playlist Start Modal -->
                <div class="modal fade" id="playlistStartModal" tabindex="-1" aria-labelledby="playlistStartModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="playlistStartModalLabel">Select Starting Video</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div id="playlist-videos-container" style="max-height:400px; overflow-y:auto;"></div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" id="confirm-start-video">Confirm</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Media Library Section -->
                <section id="media" class="content-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Media Library</h1>
                        <button class="btn btn-sm btn-outline-secondary" id="refresh-media">
                            <i class="bi bi-arrow-clockwise"></i> Refresh
                        </button>
                    </div>
                    
                    <div id="media-container">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </section>
                
                <!-- Settings Section -->
                <section id="settings" class="content-section d-none">
                    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                        <h1 class="h2">Settings</h1>
                    </div>
                    
                    <div class="card shadow mb-4">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold">Application Settings</h6>
                        </div>
                        <div class="card-body">
                            <form id="settings-form">
                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <label for="output_dir" class="form-label">Output Directory</label>
                                        <input type="text" class="form-control" id="output_dir" name="output_dir">
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="cookies_path" class="form-label">Cookies File Path</label>
                                        <input type="text" class="form-control" id="cookies_path" name="cookies_path">
                                        <div class="form-text">Optional: Path to cookies file for authenticated content</div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <label for="default_quality" class="form-label">Default Video Quality</label>
                                        <select class="form-select" id="default_quality" name="default_quality">
                                            <option value="2160">4K (2160p)</option>
                                            <option value="1440">QHD (1440p)</option>
                                            <option value="1080" selected>FHD (1080p)</option>
                                            <option value="720">HD (720p)</option>
                                            <option value="480">SD (480p)</option>
                                        </select>
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="default_crf" class="form-label">Default H.265 Quality (CRF)</label>
                                        <input type="range" class="form-range" min="18" max="32" step="1" id="default_crf" name="default_crf" value="28">
                                        <div class="d-flex justify-content-between">
                                            <small>Higher Quality</small>
                                            <small id="default-crf-value">28</small>
                                            <small>Smaller Size</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="default_use_h265" name="default_use_h265" checked>
                                            <label class="form-check-label" for="default_use_h265">Convert to H.265 by default</label>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="clean_filenames" name="clean_filenames" checked>
                                            <label class="form-check-label" for="clean_filenames">Clean filenames (spaces instead of underscores)</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <label for="web_port" class="form-label">Web Interface Port</label>
                                        <input type="number" class="form-control" id="web_port" name="web_port" min="1" max="65535" value="8000">
                                    </div>
                                    <div class="col-lg-6">
                                        <label for="completed_jobs_limit" class="form-label">Number of completed jobs to keep</label>
                                        <input type="number" class="form-control" id="completed_jobs_limit" name="completed_jobs_limit" min="1" max="100" value="10">
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-lg-6">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="auto_check_updates" name="auto_check_updates">
                                            <label class="form-check-label" for="auto_check_updates">Automatically check playlists for updates</label>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 update-schedule-settings">
                                        <label for="update_interval" class="form-label">Check interval (minutes)</label>
                                        <input type="number" class="form-control" id="update_interval" name="update_interval" min="5" value="60">
                                    </div>
                                </div>
                                
                                <!-- Jellyfin Integration Settings -->
                                <h6 class="mt-4 mb-3">Jellyfin Integration</h6>
                                
                                <div class="row mb-3">
                                    <div class="col-lg-12">
                                        <div class="form-check form-switch">
                                            <input class="form-check-input" type="checkbox" id="jellyfin_enabled" name="jellyfin_enabled">
                                            <label class="form-check-label" for="jellyfin_enabled">Enable Jellyfin integration</label>
                                        </div>
                                        <div class="form-text">Copy processed files to Jellyfin TV folder structure</div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3 jellyfin-settings">
                                    <div class="col-lg-12">
                                        <label for="jellyfin_tv_path" class="form-label">Jellyfin TV Library Path</label>
                                        <input type="text" class="form-control" id="jellyfin_tv_path" name="jellyfin_tv_path" placeholder="/path/to/jellyfin/tv">
                                        <div class="form-text">Full path to Jellyfin TV library folder</div>
                                    </div>
                                </div>
                                
                                <div class="row mb-3 jellyfin-settings">
                                    <div class="col-lg-4">
                                        <label for="jellyfin_host" class="form-label">Jellyfin Host</label>
                                        <input type="text" class="form-control" id="jellyfin_host" name="jellyfin_host" placeholder="localhost">
                                    </div>
                                    <div class="col-lg-4">
                                        <label for="jellyfin_port" class="form-label">Jellyfin Port</label>
                                        <input type="text" class="form-control" id="jellyfin_port" name="jellyfin_port" value="8096">
                                    </div>
                                    <div class="col-lg-4">
                                        <label for="jellyfin_api_key" class="form-label">API Key (Optional)</label>
                                        <input type="text" class="form-control" id="jellyfin_api_key" name="jellyfin_api_key">
                                    </div>
                                    <div class="col-12 mt-1">
                                        <div class="form-text">Optional: Provide Jellyfin server details to trigger library scan after file copy</div>
                                    </div>
                                </div>
                                
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <button type="submit" class="btn btn-primary">Save Settings</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>
    
    <div class="toast-container position-fixed bottom-0 end-0 p-3">
        <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toast-message"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>